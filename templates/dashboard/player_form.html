{% load static %}
{% load custom_filters %}

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>{% if is_edit %}Edit{% else %}Add{% endif %} Player — Nugata FC</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- Dashboard CSS -->
  <link rel="stylesheet" href="{% static 'css/dashboard.css' %}"/>
  {% if club_settings and club_settings.favicon %}
  {% with base=club_settings.favicon.url|cut:".png" %}
  <link rel="icon" type="image/png" sizes="16x16" href="{{ base }}_16x16.png">
  <link rel="icon" type="image/png" sizes="32x32" href="{{ base }}_32x32.png">
  <link rel="apple-touch-icon" sizes="180x180" href="{{ base }}_180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="{{ base }}_192x192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="{{ base }}_512x512.png">
  {% endwith %}
  {% else %}
  <link rel="icon" href="{% static 'default-favicon.ico' %}">
  {% endif %}


  <style>
    /* Enhanced styling for the player form */
    .form-container {
      background: white;
      border-radius: 16px;
      padding: 32px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.08);
      margin-bottom: 40px;
    }
    
    .team-header {
      display: flex;
      align-items: center;
      gap: 16px;
      margin-bottom: 32px;
      padding-bottom: 20px;
      border-bottom: 2px solid #f1f5f9;
    }
    
    .team-icon {
      width: 60px;
      height: 60px;
      border-radius: 16px;
      background: linear-gradient(135deg, var(--primary) 0%, #3b82f6 100%);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
    }
    
    .team-header h2 {
      margin: 0;
      font-size: 28px;
      font-weight: 700;
      color: #1e293b;
      background: linear-gradient(135deg, #1e293b 0%, #475569 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 24px;
      margin-bottom: 24px;
    }
    
    @media (max-width: 968px) {
      .form-grid {
        grid-template-columns: 1fr;
      }
    }
    
    .form-section {
      margin-bottom: 32px;
    }
    
    .section-title {
      font-size: 18px;
      font-weight: 600;
      color: #1e293b;
      margin-bottom: 20px;
      padding-bottom: 12px;
      border-bottom: 2px solid #e2e8f0;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .section-title i {
      color: var(--primary);
      background: #eff6ff;
      padding: 8px;
      border-radius: 10px;
    }
    
    .form-group {
      margin-bottom: 24px;
      position: relative;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 10px;
      font-weight: 600;
      color: #374151;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .form-group label i {
      color: var(--primary);
      font-size: 16px;
    }
    
    .form-input, .form-select {
      width: 100%;
      padding: 14px 16px;
      border: 2px solid #e2e8f0;
      border-radius: 12px;
      background: white;
      color: #1e293b;
      font-family: 'Inter', sans-serif;
      font-size: 15px;
      transition: all 0.3s ease;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.03);
    }
    
    .form-input:focus, .form-select:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.15);
      transform: translateY(-2px);
    }
    
    .form-input:hover, .form-select:hover {
      border-color: #cbd5e1;
    }
    
    .select-wrapper {
      position: relative;
    }
    
    .select-wrapper::after {
      content: "⌄";
      position: absolute;
      right: 16px;
      top: 50%;
      transform: translateY(-50%);
      color: #64748b;
      font-size: 18px;
      pointer-events: none;
    }
    
    .checkbox-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      gap: 12px;
      margin-top: 8px;
    }
    
    .checkbox-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 12px;
      background: #f8fafc;
      border-radius: 10px;
      transition: all 0.2s ease;
      cursor: pointer;
    }
    
    .checkbox-item:hover {
      background: #eff6ff;
      transform: translateY(-2px);
    }
    
    .checkbox-item input[type="checkbox"] {
      width: 18px;
      height: 18px;
      border-radius: 4px;
      border: 2px solid #cbd5e1;
      cursor: pointer;
    }
    
    .checkbox-item input[type="checkbox"]:checked {
      background-color: var(--primary);
      border-color: var(--primary);
    }
    
    .checkbox-item label {
      margin: 0;
      cursor: pointer;
      font-weight: 500;
      color: #475569;
    }
    
    .form-actions {
      display: flex;
      justify-content: flex-end;
      align-items: center;
      gap: 16px;
      margin-top: 40px;
      padding-top: 24px;
      border-top: 2px solid #f1f5f9;
    }
    
    .btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 14px 28px;
      border-radius: 12px;
      font-weight: 600;
      font-size: 15px;
      text-decoration: none;
      transition: all 0.3s ease;
      border: none;
      cursor: pointer;
      font-family: 'Inter', sans-serif;
    }
    
    .btn-success {
      background: linear-gradient(135deg, var(--success) 0%, #16a34a 100%);
      color: white;
      box-shadow: 0 4px 12px rgba(34, 197, 94, 0.3);
    }
    
    .btn-success:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(34, 197, 94, 0.4);
    }
    
    .btn-secondary {
      background: white;
      color: #64748b;
      border: 2px solid #e2e8f0;
    }
    
    .btn-secondary:hover {
      background: #f8fafc;
      transform: translateY(-2px);
      border-color: #cbd5e1;
    }
    
    .alert {
      padding: 16px 20px;
      border-radius: 12px;
      margin-bottom: 24px;
      display: flex;
      align-items: center;
      gap: 12px;
      border: 2px solid transparent;
    }
    
    .alert-success {
      background: #f0fdf4;
      color: #166534;
      border-color: #bbf7d0;
    }
    
    .alert-danger {
      background: #fef2f2;
      color: #b91c1c;
      border-color: #fecaca;
    }
    
    .alert i {
      font-size: 20px;
    }
    
    .errors {
      background: #fef2f2;
      border: 2px solid #fecaca;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 24px;
    }
    
    .errors strong {
      color: #b91c1c;
      margin-bottom: 12px;
      display: block;
    }
    
    .errors ul {
      margin: 0;
      padding-left: 20px;
      color: #b91c1c;
    }
    
    .errors li {
      margin-bottom: 6px;
    }
    
    .jersey-preview {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-top: 8px;
    }
    
    .jersey-circle {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: var(--primary);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 18px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }
    
    .form-hint {
      font-size: 13px;
      color: #64748b;
      margin-top: 6px;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .form-hint i {
      color: var(--primary);
    }
    
    /* Animation */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .form-group {
      animation: fadeIn 0.4s ease-out;
    }
    
    .form-group:nth-child(1) { animation-delay: 0.1s; }
    .form-group:nth-child(2) { animation-delay: 0.2s; }
    .form-group:nth-child(3) { animation-delay: 0.3s; }
    .form-group:nth-child(4) { animation-delay: 0.4s; }
  </style>
</head>
<body>
    <div class="dashboard-container">
  {% include "dashboard/partials/sidebar.html" %}

  <div class="main-content">
    <div class="header">
      <h1 class="page-title">{% if form.instance.pk %}Edit{% else %}Assign{% endif %} Player to Season</h1>
      <div class="user-menu">
        <div class="search-box">
          <i class="fas fa-search"></i>
          <input type="text" placeholder="Search...">
        </div>
        <div class="user-profile">
          <div class="user-info">
            <div class="user-name">
              {% with members|get_member:request.user as current_member %}
                {{ current_member.name|default:request.user.username }}
              {% endwith %}
            </div>
            <div class="user-role">
              {% with members|get_member:request.user as current_member %}
                {% if current_member and current_member.role %}
                  {{ current_member.role.name }}
                {% else %}
                  {% if request.user.is_superuser %}
                    Administrator
                  {% else %}
                    Staff Member
                  {% endif %}
                {% endif %}
              {% endwith %}
            </div>
          </div>
          <div class="avatar">
            {% with members|get_member:request.user as current_member %}
              {% if current_member and current_member.picture %}
                <img src="{{ current_member.picture.url }}" alt="{{ current_member.name|default:request.user.username }}">
              {% else %}
                {{ current_member.name|default:request.user.get_full_name|default:request.user.username|first|upper }}
              {% endif %}
            {% endwith %}
          </div>
        </div>
      </div>
    </div>

    {% if messages %}
      <div class="form-container">
        {% for message in messages %}
          <div class="alert alert-{% if message.tags == 'success' %}success{% else %}danger{% endif %}">
            <i class="fas {% if message.tags == 'success' %}fa-check-circle{% else %}fa-exclamation-circle{% endif %}"></i>
            {{ message }}
          </div>
        {% endfor %}
      </div>
    {% endif %}

    <div class="form-container">
      <div class="team-header">
        <div class="team-icon"><i class="fas fa-user-plus"></i></div>
        <h2>Player Assignment Details</h2>
      </div>

      {% if form.errors or form.non_field_errors %}
        <div class="errors">
          <strong>Please fix the errors below:</strong>
          <ul>
            {% for err in form.non_field_errors %}<li>{{ err }}</li>{% endfor %}
            {% for field in form %}
              {% for err in field.errors %}<li>{{ field.label }}: {{ err }}</li>{% endfor %}
            {% endfor %}
          </ul>
        </div>
      {% endif %}

      <form method="POST" action="" class="form-content">
        {% csrf_token %}
        
        <div class="form-grid">
          <!-- Player Selection -->
          <div class="form-group">
            <label for="id_player"><i class="fas fa-user"></i>Player</label>
            <div class="select-wrapper">
              {{ form.player }}
            </div>
            <div class="form-hint">
              <i class="fas fa-info-circle"></i> Select a player to assign to the season
            </div>
          </div>
          
          <!-- Season Selection -->
          <div class="form-group">
            <label for="id_season"><i class="fas fa-calendar"></i>Season</label>
            <div class="select-wrapper">
              {{ form.season }}
            </div>
            <div class="form-hint">
              <i class="fas fa-info-circle"></i> Choose the season for this assignment
            </div>
          </div>
        </div>
        
        <div class="form-grid">
          <!-- Jersey Number -->
          <div class="form-group">
            <label for="id_jersey_number"><i class="fas fa-tshirt"></i>Jersey Number</label>
            {{ form.jersey_number }}
            <div id="jerseyPreview" class="jersey-preview">
              <div class="jersey-circle">#</div>
              <span>Jersey number preview</span>
            </div>
          </div>
          
          <!-- Positions -->
          <div class="form-group">
            <label><i class="fas fa-map-marker-alt"></i>Positions</label>
            <div class="checkbox-grid">
              {% for checkbox in form.positions %}
                <div class="checkbox-item">
                  {{ checkbox.tag }}
                  <label for="{{ checkbox.id_for_label }}">{{ checkbox.choice_label }}</label>
                </div>
              {% endfor %}
            </div>
            <div class="form-hint">
              <i class="fas fa-info-circle"></i> Select all positions this player can play
            </div>
          </div>
        </div>

        <div class="form-actions">
          <a href="{% url 'dashboard:player_manager' %}" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> Cancel
          </a>
          <button type="submit" class="btn btn-success">
            <i class="fas fa-save"></i> Save Assignment
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Add styling to form elements
    const selects = document.querySelectorAll('select');
    selects.forEach(select => {
      select.className = 'form-select';
    });

    const inputs = document.querySelectorAll('input[type="text"], input[type="number"]');
    inputs.forEach(input => {
      if (!input.className) {
        input.className = 'form-input';
      }
    });
    
    // Jersey number preview
    const jerseyInput = document.getElementById('id_jersey_number');
    const jerseyPreview = document.querySelector('.jersey-circle');
    
    if (jerseyInput && jerseyPreview) {
      jerseyInput.addEventListener('input', function() {
        jerseyPreview.textContent = this.value ? '#' + this.value : '#';
      });
      
      // Set initial value
      jerseyPreview.textContent = jerseyInput.value ? '#' + jerseyInput.value : '#';
    }
    
    // Add search functionality to player dropdown
    const playerSelect = document.getElementById('id_player');
    if (playerSelect) {
      const playerSearch = document.createElement('input');
      playerSearch.type = 'text';
      playerSearch.placeholder = 'Search players...';
      playerSearch.className = 'form-input';
      playerSearch.style.marginBottom = '12px';
      
      playerSelect.parentNode.insertBefore(playerSearch, playerSelect);
      
      playerSearch.addEventListener('input', function() {
        const searchTerm = this.value.toLowerCase();
        const options = playerSelect.options;
        
        for (let i = 0; i < options.length; i++) {
          const option = options[i];
          if (option.text.toLowerCase().includes(searchTerm)) {
            option.style.display = '';
          } else {
            option.style.display = 'none';
          }
        }
      });
    }
    
    // Add animation to form elements
    const formGroups = document.querySelectorAll('.form-group');
    formGroups.forEach((group, index) => {
      group.style.animationDelay = `${0.1 + (index * 0.1)}s`;
    });
  });
</script>
</body>
</html>