{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{{ player.full_name }} | Profile | Official Website | Nugata FC</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&family=Bebas+Neue&display=swap" rel="stylesheet" />
    
    <!-- Then link to your external CSS file -->
    <link rel="stylesheet" href="{% static 'css/main.css' %}" />
    
    {% if club_settings and club_settings.favicon %}
    {% with base=club_settings.favicon.url|cut:".png" %}
    <link rel="icon" type="image/png" sizes="16x16" href="{{ base }}_16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="{{ base }}_32x32.png">
    <link rel="apple-touch-icon" sizes="180x180" href="{{ base }}_180x180.png">
    <link rel="icon" type="image/png" sizes="192x192" href="{{ base }}_192x192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="{{ base }}_512x512.png">
    {% endwith %}
    {% else %}
    <link rel="icon" href="{% static 'default-favicon.ico' %}">
    {% endif %}
    <style>
        :root {
            --color-primary: {{ brand_colors.primary }};
            --color-secondary: {{ brand_colors.secondary }};
            --color-neutral-dark: {{ brand_colors.neutral_dark }};
            --color-neutral-light: {{ brand_colors.neutral_light }};
            --color-accent: #ffd700;
            --card-shadow: 0 10px 20px rgba(0,0,0,0.08);
            --transition: all 0.3s ease;
        }
        
        body {
            font-family: 'Montserrat', sans-serif;
            background-color: #f8f9fa;
            color: #333;
            line-height: 1.6;
        }
        
        .player-detail-page {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
        }
        
        /* Player Header Section */
        .player-details {
            background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-secondary) 100%);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: var(--card-shadow);
            margin-bottom: 2.5rem;
            color: white;
            position: relative;
        }
        
        .player-header {
            display: flex;
            padding: 2rem;
            position: relative;
            z-index: 2;
        }
        
        .player-details::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%23ffffff' fill-opacity='0.1' fill-rule='evenodd'/%3E%3C/svg%3E");
            z-index: 1;
        }
        
        .player-photo {
            flex: 0 0 280px;
            margin-right: 2.5rem;
        }
        
        .player-photo img {
            width: 100%;
            height: auto;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            border: 3px solid white;
            transition: var(--transition);
        }
        
        .player-photo img:hover {
            transform: scale(1.03);
        }
        
        .player-info {
            flex: 1;
        }
        
        .player-name {
            font-family: 'Bebas Neue', cursive;
            font-size: 3.5rem;
            margin: 0 0 1rem 0;
            letter-spacing: 1.5px;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .player-info p {
            margin-bottom: 0.8rem;
            display: flex;
            align-items: center;
            font-size: 1.1rem;
        }
        
        .player-info strong {
            min-width: 140px;
            display: inline-block;
            color: var(--color-accent);
        }
        
        /* Bio Section */
        .player-bio {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 2.5rem;
            box-shadow: var(--card-shadow);
        }
        
        .player-bio h2 {
            font-family: 'Bebas Neue', cursive;
            font-size: 2.2rem;
            color: var(--color-primary);
            margin-top: 0;
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 3px solid var(--color-accent);
            display: inline-block;
        }
        
        /* Stats Section */
        .player-stats-section {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            box-shadow: var(--card-shadow);
        }
        
        .stats-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .stats-title {
            font-family: 'Bebas Neue', cursive;
            font-size: 2.2rem;
            color: var(--color-primary);
            margin: 0;
            padding-bottom: 0.5rem;
            border-bottom: 3px solid var(--color-accent);
            display: inline-block;
        }
        
        /* Filters */
        .filters {
            display: flex;
            gap: 1rem;
            align-items: center;
        }
        
        .filter-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .filters label {
            font-weight: 600;
            color: var(--color-neutral-dark);
            font-size: 0.9rem;
            white-space: nowrap;
        }
        
        .filters select {
            padding: 0.4rem 0.8rem;
            border: 1.5px solid #e9ecef;
            border-radius: 6px;
            background-color: white;
            font-family: 'Segoe UI', sans-serif;
            font-size: 0.9rem;
            transition: var(--transition);
            min-width: 120px;
        }
        
        .filters select:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 2px rgba(var(--color-primary-rgb), 0.1);
        }
        
        /* Updated Stats List - Label on left, value on right */
        .stats-list {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 2rem;
        }
        
        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #e9ecef;
            padding-bottom: 1rem;
        }
        
        .stat-label {
            font-size: 1rem;
            font-weight: 600;
            color: var(--color-neutral-dark);
        }
        
        .stat-value {
            font-size: 2.2rem;
            font-weight: 700;
            color: var(--color-primary);
            line-height: 1;
        }
        
        .stat-description {
            font-size: 0.8rem;
            color: #6c757d;
            margin-top: 0.3rem;
        }
        
        /* Responsive Design */
        @media (max-width: 900px) {
            .player-header {
                flex-direction: column;
                text-align: center;
            }
            
            .player-photo {
                margin-right: 0;
                margin-bottom: 1.5rem;
                flex: 0 0 auto;
                max-width: 280px;
                margin-left: auto;
                margin-right: auto;
            }
            
            .player-info p {
                justify-content: center;
            }
            
            .stats-list {
                grid-template-columns: 1fr;
            }
            
            .stats-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .filters {
                width: 100%;
                justify-content: flex-end;
            }
        }
        
        @media (max-width: 600px) {
            .player-info p {
                flex-direction: column;
                text-align: center;
            }
            
            .player-info strong {
                min-width: auto;
                margin-bottom: 0.3rem;
            }
            
            .player-name {
                font-size: 2.8rem;
            }
            
            .filters {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.8rem;
            }
            
            .filter-group {
                width: 100%;
                justify-content: space-between;
            }
            
            .filters select {
                min-width: 0;
                flex: 1;
            }
            
            .stat-value {
                font-size: 1.8rem;
            }
        }
        
    </style>
</head>
<body>
    {% include "home/partials/header.html" %}

    <main class="player-detail-page">

        <!-- ================= Player Details ================= -->
        <section class="player-details">
            <div class="player-header">
                <div class="player-photo">
                    {% if player.photo %}
                        <img src="{{ player.photo.url }}" alt="{{ player.full_name }}">
                    {% else %}
                        <img src="{% static 'images/default-player.png' %}" alt="{{ player.full_name }}">
                    {% endif %}
                </div>
                <div class="player-info">
                    <h1 class="player-name">{{ player.full_name }}</h1>
                    <p><strong>Place of Birth:</strong> {{ player.place_of_birth|default:"N/A" }}</p>
                    <p><strong>Position:</strong>
                        {% if player_season %}
                            {% for pos in player_season.positions.all %}
                                {{ pos.name }}{% if not forloop.last %}, {% endif %}
                            {% endfor %}
                        {% else %}
                            N/A
                        {% endif %}
                    </p>
                    <p><strong>DOB:</strong> {{ player.date_of_birth|date:"F j, Y"|default:"N/A" }}</p>
                    <p><strong>Height:</strong> {{ player.height|default:"N/A" }}m</p>
                    <p><strong>Debut:</strong> {{ player.joined_date|date:"F j, Y"|default:"N/A" }}</p>
                </div>
            </div>
        </section>

        <!-- ================= Bio ================= -->
        <section class="player-bio">
            <h2>Biography</h2>
            <p>{{ player.bio|linebreaksbr|default:"No biography available." }}</p>
        </section>

        <!-- ================= Statistics ================= -->
        <section class="player-stats-section">
            <div class="stats-header">
                <h2 class="stats-title">Statistics</h2>
                
                <!-- Filters -->
                <div class="filters">
                    <div class="filter-group">
                        <label for="match_type">Match Type:</label>
                        <select id="match_type" name="match_type">
                            {% for value, label in match_types %}
                                <option value="{{ value }}" {% if value == selected_match_type %}selected{% endif %}>
                                    {{ label }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="filter-group">
                        <label for="season">Season:</label>
                        <select id="season" name="season">
                            {% for s in available_seasons %}
                                <option value="{{ s.id }}" {% if selected_season and s.id == selected_season.id %}selected{% endif %}>
                                    {{ s.name }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
            </div>

            <!-- Updated stats container with label on left, value on right -->
            <div id="stats-container" class="stats-list">
                <div class="stat-item">
                    <div class="stat-label">Appearances</div>
                    <div class="stat-value">{{ stats.appearances|default:"0" }}</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Minutes Played</div>
                    <div class="stat-value">{{ stats.minutes_played|default:"0" }}</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Goals</div>
                    <div class="stat-value">{{ stats.goals|default:"0" }}</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Assists</div>
                    <div class="stat-value">{{ stats.assists|default:"0" }}</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Penalties Taken</div>
                    <div class="stat-value">{{ stats.penalties_taken|default:"0" }}</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Penalties Scored</div>
                    <div class="stat-value">{{ stats.penalties_scored|default:"0" }}</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Yellow Cards</div>
                    <div class="stat-value">{{ stats.yellow_cards|default:"0" }}</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Red Cards</div>
                    <div class="stat-value">{{ stats.red_cards|default:"0" }}</div>
                </div>

                {# role-specific (optional duplicates ok) #}
                {% if player_role == "goalkeeper" %}
                    <div class="stat-item">
                        <div class="stat-label">Saves</div>
                        <div class="stat-value">{{ stats.saves|default:"0" }}</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Penalties Saved</div>
                        <div class="stat-value">{{ stats.penalties_saved|default:"0" }}</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Clean Sheets</div>
                        <div class="stat-value">{{ stats.clean_sheets|default:"0" }}</div>
                    </div>
                {% elif player_role == "defender" %}
                    <div class="stat-item">
                        <div class="stat-label">Tackles Won</div>
                        <div class="stat-value">{{ stats.tackles_won|default:"0" }}</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Clearances</div>
                        <div class="stat-value">{{ stats.clearances|default:"0" }}</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Clean Sheets</div>
                        <div class="stat-value">{{ stats.clean_sheets|default:"0" }}</div>
                    </div>
                {% elif player_role == "midfielder" %}
                    <div class="stat-item">
                        <div class="stat-label">Big Chances Created</div>
                        <div class="stat-value">{{ stats.big_chances_created|default:"0" }}</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Tackles Won</div>
                        <div class="stat-value">{{ stats.tackles_won|default:"0" }}</div>
                    </div>
                {% elif player_role == "forward" %}
                    <div class="stat-item">
                        <div class="stat-label">Big Chances Created</div>
                        <div class="stat-value">{{ stats.big_chances_created|default:"0" }}</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Penalties Scored</div>
                        <div class="stat-value">{{ stats.penalties_scored|default:"0" }}</div>
                    </div>
                {% endif %}
            </div>
        </section>

    </main>

    {% include "home/partials/footer.html" %}

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const matchTypeSelect = document.getElementById("match_type");
            const seasonSelect = document.getElementById("season");

            function updateStats() {
                const matchType = matchTypeSelect ? matchTypeSelect.value : null;
                const seasonId = seasonSelect ? seasonSelect.value : null;

                // navigate with query params; if one is missing, still include the other
                const params = new URLSearchParams(window.location.search);
                if (matchType !== null) params.set('match_type', matchType);
                if (seasonId !== null) params.set('season', seasonId);

                window.location.href = `${window.location.pathname}?${params.toString()}`;
            }

            if (matchTypeSelect) matchTypeSelect.addEventListener("change", updateStats);
            if (seasonSelect) seasonSelect.addEventListener("change", updateStats);
        });
    </script>
</body>
</html>